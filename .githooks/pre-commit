#!/bin/sh

# Add common Node.js paths
export PATH="/usr/local/bin:/opt/homebrew/bin:$PATH"

# Source user's shell profile for nvm/node if available
if [ -f "$HOME/.nvm/nvm.sh" ]; then
    . "$HOME/.nvm/nvm.sh"
fi

echo "[PRE-COMMIT] Running lint-staged on staged files..."
npx lint-staged || {
    echo "[ERROR] Lint-staged checks failed. Fix issues before committing."
    exit 1
}

echo "[PRE-COMMIT] Running full TypeScript type check..."
npx tsc --noEmit --skipLibCheck || {
    echo "[ERROR] TypeScript check failed. Fix type errors before committing."
    exit 1
}

echo "[PRE-COMMIT] Running tests..."
npm test -- --passWithNoTests --onlyChanged || {
    echo "[ERROR] Tests failed. Fix failing tests before committing."
    exit 1
}

echo "[SUCCESS] All pre-commit checks passed!"
exit 0